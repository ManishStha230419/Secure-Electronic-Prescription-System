{% extends "base.html" %}
{% block title %}Certificate Revocation List{% endblock %}
{% block content %}
<div class="card">
    <div class="card-header bg-danger text-white">
        <h4 class="mb-0"><i class="bi bi-list-ul"></i> Certificate Revocation List (CRL)</h4>
        <small>PKI Key Revocation â€” All revoked certificates are listed here</small>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> A CRL is a list of certificates that have been revoked before their expiry date. Any prescription signed with a revoked certificate will be rejected.
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>User</th><th>Role</th><th>Serial Number</th>
                        <th>Revoked At</th><th>Reason</th><th>Revoked By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in revocations %}
                    <tr>
                        <td>{{ r.user.full_name if r.user else 'Unknown' }}</td>
                        <td><span class="badge bg-secondary">{{ r.user.role if r.user else '-' }}</span></td>
                        <td><code class="small">{{ r.serial_number }}</code></td>
                        <td>{{ r.revoked_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td><span class="badge bg-danger">{{ r.reason }}</span></td>
                        <td>{{ r.revoker.username if r.revoker else 'System' }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="6" class="text-center text-muted py-4">No certificates revoked</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if session.get('role') in ['admin', 'doctor'] %}
        <a href="{{ url_for('revoke_key') }}" class="btn btn-danger"><i class="bi bi-x-circle"></i> Revoke a Certificate</a>
        {% endif %}
    </div>
</div>
{% endblock %}
